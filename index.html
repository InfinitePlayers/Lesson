<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dexter's Tuesday Plan</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        /* --- Core Visuals --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Gray-100 */
            color: #1f2937; /* Gray-800 */
        }
        
        /* --- Schedule Blocks --- */
        .schedule-block {
            background-color: white;
            padding: 1.5rem; /* p-6 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            margin-bottom: 1.5rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        /* Active State - Blue Border & Highlight */
        .current-block {
            border-color: #3b82f6; /* blue-500 */
            border-width: 4px;
            transform: scale(1.01);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            opacity: 1;
        }

        /* Completed State - Greyed Out */
        .completed-block {
            background-color: #f9fafb; /* gray-50 */
            opacity: 0.6;
            border-color: #e5e7eb; /* gray-200 */
        }
        
        /* Task Status Colors */
        .task-card-complete {
             border-color: #10b981; /* green-500 */
             background-color: #ecfdf5; /* green-50 */
        }
        
        .task-card-missed {
            border-color: #f59e0b; /* amber-500 */
            background-color: #fffbeb; /* amber-50 */
        }

        /* --- Components --- */
        .progress-bar-container {
            width: 100%;
            background-color: #1e40af; /* blue-800 */
            border-radius: 0.25rem;
            overflow: hidden;
            height: 1.25rem;
        }
        .progress-bar {
            height: 100%;
            background-color: #60a5fa; /* blue-400 */
            width: 0%;
            transition: width 0.5s ease-out;
            text-align: right;
            padding-right: 8px;
            color: #0f172a;
            font-weight: bold;
            font-size: 0.75rem;
            line-height: 1.25rem;
        }

        .reminder-box {
            background-color: #fffbeb; /* yellow-50 */
            border-left: 4px solid #facc15; /* yellow-400 */
            padding: 0.75rem;
            margin-top: 1rem;
            color: #92400e; /* yellow-800 */
            font-weight: 600;
        }

        /* --- Start Overlay (Modal Style) --- */
        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Dark overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.5s ease;
        }
        
        #start-box {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 90%;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Start Overlay -->
    <div id="start-overlay">
        <div id="start-box">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Tuesday, 18th</h1>
            <p class="text-gray-600 mb-6">Click start to enable the schedule timer and audio.</p>
            <button id="start-schedule-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg transition-transform transform hover:scale-105">
                Start Schedule
            </button>
        </div>
    </div>

    <!-- App Content Wrapper -->
    <div id="app-content" class="max-w-3xl mx-auto">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-600">TODAY'S PLAN</h1>
            <p class="text-2xl text-gray-600">For Dexter</p>
        </header>

        <!-- Status Sticky Bar -->
        <div id="status-section" class="bg-blue-600 text-white p-4 rounded-lg shadow-lg mb-8 sticky top-4 z-50">
            <div class="flex justify-between items-center mb-2">
                <div>
                    <div class="text-xs text-blue-200 uppercase">Time</div>
                    <div id="current-time" class="text-2xl font-bold">--:--</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-blue-200 uppercase">Current Task</div>
                    <div id="current-activity" class="text-xl font-bold">--</div>
                </div>
            </div>
            
            <!-- Timer Details -->
            <div id="timer-details" class="hidden border-t border-blue-500 pt-2 mt-2">
                <div class="flex justify-between items-end mb-1">
                    <span class="text-sm font-medium text-blue-100">Time Remaining</span>
                    <span id="time-left" class="text-xl font-bold">00:00</span>
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- Schedule Container -->
        <main id="schedule-container" class="space-y-4 pb-24">
             <!-- Schedule blocks will be targeted by JS -->
             
            <!-- 1. Tutor Time -->
            <section id="block-0830" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Tutor Time / Prep
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-0830" title="Play instructions">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">8:30 - 9:00</span>
                </div>
                <p class="text-gray-600 mb-2">Get ready for the day. Check MS Teams.</p>
                <ul class="list-disc list-inside text-gray-600">
                    <li>Maths (Get Sparx Maths login ready)</li>
                    <li>Core Skills (Check Teams for tasks)</li>
                </ul>
            </section>

            <!-- 2. Maths -->
            <section id="block-0900" class="schedule-block academic-task" data-task-id="block-0900">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Maths (P1) - Sparx
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-0900">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">9:00 - 9:50</span>
                </div>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li>Check MS Teams for lesson.</li>
                    <li>Login to <a href="https://www.sparxmaths.com/" target="_blank" class="text-blue-600 underline">Sparx Maths</a>.</li>
                    <li><b>Goal:</b> Complete assigned homework to 100%.</li>
                </ul>
                <button class="complete-btn hidden w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-all" data-task-id="block-0900">
                    Mark as Complete
                </button>
            </section>

            <!-- 3. Break -->
            <section id="block-0950" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">Short Break</h2>
                    <span class="text-lg font-semibold text-gray-500">9:50 - 9:55</span>
                </div>
                <p class="text-gray-600">Quick stretch.</p>
            </section>

            <!-- 4. Core Skills 1 -->
            <section id="block-0955" class="schedule-block academic-task" data-task-id="block-0955">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Core Skills (P2)
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-0955">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">9:55 - 10:45</span>
                </div>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li>Check MS Teams for tasks.</li>
                    <li>Fallback: 20 mins <a href="https://www.typingclub.com/" target="_blank" class="text-blue-600 underline">TypingClub</a>.</li>
                    <li><b>Goal:</b> Finish assigned work or 3-4 typing levels.</li>
                </ul>
                <button class="complete-btn hidden w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-all" data-task-id="block-0955">
                    Mark as Complete
                </button>
            </section>

            <!-- 5. Morning Break -->
            <section id="block-1045" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">Morning Break</h2>
                    <span class="text-lg font-semibold text-gray-500">10:45 - 11:15</span>
                </div>
                <p class="text-gray-600">Snack time. Move away from the screen.</p>
            </section>

            <!-- 6. Core Skills 2 -->
            <section id="block-1115" class="schedule-block academic-task" data-task-id="block-1115">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Core Skills (P3)
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-1115">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">11:15 - 12:05</span>
                </div>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li>Check MS Teams.</li>
                    <li>Fallback: <a href="https://www.bbc.co.uk/bitesize/levels/z4l9kqt" target="_blank" class="text-blue-600 underline">BBC Bitesize KS3</a> English or Maths.</li>
                    <li><b>Goal:</b> Complete one full topic/lesson.</li>
                </ul>
                <button class="complete-btn hidden w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-all" data-task-id="block-1115">
                    Mark as Complete
                </button>
            </section>

            <!-- 7. Short Break -->
            <section id="block-1205" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700">Short Break</h2>
                    <span class="text-lg font-semibold text-gray-500">12:05 - 12:10</span>
                </div>
                <p class="text-gray-600">Reset for Science.</p>
            </section>

            <!-- 8. Science -->
            <section id="block-1210" class="schedule-block academic-task" data-task-id="block-1210">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        How Science Works (P4)
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-1210">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">12:10 - 13:00</span>
                </div>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li>Check MS Teams.</li>
                    <li>Fallback: <a href="https://classroom.thenational.academy/subjects-by-year/year-8/subjects/science" target="_blank" class="text-blue-600 underline">Oak Academy Science</a>.</li>
                    <li><b>Goal:</b> Watch video & complete quiz.</li>
                </ul>
                <button class="complete-btn hidden w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-all" data-task-id="block-1210">
                    Mark as Complete
                </button>
            </section>

            <!-- 9. Lunch -->
            <section id="block-1300" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Lunch & Dog Walk
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-1300">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">13:00 - 14:00</span>
                </div>
                <p class="text-gray-600">Eat lunch, drink water, walk the dog.</p>
            </section>

            <!-- 10. Tutor PM -->
            <section id="block-1400" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Tutor Time PM / Prep
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-1400">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">14:00 - 14:15</span>
                </div>
                <p class="text-gray-600 mb-1">Prep for afternoon:</p>
                <ul class="list-disc list-inside text-gray-600">
                    <li>Geography & Biology tasks.</li>
                    <li><b>Coach Call @ 3:30 PM</b> (Find Zoom link now).</li>
                </ul>
            </section>

            <!-- 11. Geography -->
            <section id="block-1415" class="schedule-block academic-task" data-task-id="block-1415">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Geography (P5)
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-1415">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">14:15 - 15:05</span>
                </div>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li>Check MS Teams.</li>
                    <li>Fallback: <a href="https://www.bbc.co.uk/bitesize/subjects/zrw76sg" target="_blank" class="text-blue-600 underline">BBC Bitesize Geography</a>.</li>
                    <li><b>Goal:</b> Complete task or write 5 facts.</li>
                </ul>
                <button class="complete-btn hidden w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-all" data-task-id="block-1415">
                    Mark as Complete
                </button>
                <div class="reminder-box">
                    REMINDER: Coach session in ~1 hour (3:30 PM).
                </div>
            </section>

            <!-- 12. Break -->
            <section id="block-1505" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700">Short Break</h2>
                    <span class="text-lg font-semibold text-gray-500">15:05 - 15:10</span>
                </div>
                <p class="text-gray-600">Last break before coach call.</p>
            </section>

            <!-- 13. Biology -->
            <section id="block-1510" class="schedule-block academic-task" data-task-id="block-1510">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                        Biology (P6)
                        <button class="tts-play-btn ml-2 text-gray-400 hover:text-blue-600" data-block-id="block-1510">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">15:10 - 15:28</span>
                </div>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li>Check MS Teams.</li>
                    <li>Fallback: <a href="https://www.bbc.co.uk/bitesize/subjects/z4882hv" target="_blank" class="text-blue-600 underline">BBC Bitesize Biology</a>.</li>
                    <li><b>Goal:</b> Complete before coach call.</li>
                </ul>
                <button class="complete-btn hidden w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-all" data-task-id="block-1510">
                    Mark Biology as Complete
                </button>
                 <div class="reminder-box">
                    REMINDER: Coach call in 15 mins (3:30 PM).
                </div>
            </section>

            <!-- 14. Coach Prep -->
            <section id="block-1528" class="schedule-block border-l-4 border-purple-500">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-purple-700 flex items-center">
                        Coach Prep Time
                        <button class="tts-play-btn ml-2 text-purple-400 hover:text-purple-600" data-block-id="block-1528">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">15:28 - 15:30</span>
                </div>
                <p class="text-gray-600">Grab a drink. Open Zoom.</p>
            </section>

            <!-- 15. Coach Zoom -->
            <section id="block-1530" class="schedule-block border-l-4 border-purple-500">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-purple-700 flex items-center">
                        Coach Zoom Session
                        <button class="tts-play-btn ml-2 text-purple-400 hover:text-purple-600" data-block-id="block-1530">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">15:30 - 15:45</span>
                </div>
                <p class="text-gray-600">Focus on problem-solving skills.</p>
            </section>

            <!-- 16. Quick Challenge -->
            <section id="block-1545" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-orange-600 flex items-center">
                        Quick Challenge
                        <button class="tts-play-btn ml-2 text-orange-400 hover:text-orange-600" data-block-id="block-1545">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">15:45 - 16:00</span>
                </div>
                <p class="text-gray-600 mb-4">Wind down. Try <a href="https://quickdraw.withgoogle.com/" target="_blank" class="text-blue-600 underline">Google Quick Draw</a>.</p>
            </section>

            <!-- 17. Free Time -->
            <section id="block-1600" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-gray-700">Free Time</h2>
                    <span class="text-lg font-semibold text-gray-500">16:00 - 16:30</span>
                </div>
                <p class="text-gray-600">Relax before gaming.</p>
            </section>

            <!-- 18. Incentive -->
            <section id="block-1630" class="schedule-block">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold text-green-600 flex items-center">
                        Incentive Time!
                        <button class="tts-play-btn ml-2 text-green-400 hover:text-green-600" data-block-id="block-1630">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </button>
                    </h2>
                    <span class="text-lg font-semibold text-gray-500">16:30 - 17:30</span>
                </div>

                <!-- Locked State -->
                <div id="incentive-locked">
                    <p class="text-gray-600 mb-2">Complete 4 tasks to unlock.</p>
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                        <div id="task-progress-bar" class="bg-blue-600 h-4 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="task-progress-text" class="text-center font-bold text-gray-700">0 / 6 Tasks</p>
                    <button id="parent-approval-btn" class="w-full mt-4 bg-gray-300 text-white font-bold py-3 px-4 rounded-lg cursor-not-allowed" disabled>
                        Awaiting Tasks...
                    </button>
                </div>

                <!-- Unlocked State -->
                <div id="incentive-unlocked" class="hidden mt-4 p-4 bg-green-50 border-2 border-green-200 rounded-lg text-center">
                    <h3 class="text-2xl font-bold text-green-700 mb-2">REWARD UNLOCKED!</h3>
                    <p class="text-green-800 text-xl">1 Hour Gaming Time</p>
                </div>
            </section>

            <!-- 19. Done -->
            <section id="block-1730" class="schedule-block">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-700">All Done!</h2>
                    <span class="text-lg font-semibold text-gray-500">17:30+</span>
                </div>
            </section>

        </main>
    </div>

    <!-- Scripts -->
    <script>
        // Script last updated: 2025-11-18 14:16 PM GMT
        
        // DOM Elements
        const timeEl = document.getElementById('current-time');
        const activityEl = document.getElementById('current-activity');
        const timeLeftEl = document.getElementById('time-left');
        const timerDetailsEl = document.getElementById('timer-details');
        const progressBarEl = document.getElementById('progress-bar');
        const startOverlayEl = document.getElementById('start-overlay');
        const startBtnEl = document.getElementById('start-schedule-btn');
        const appContentEl = document.getElementById('app-content');

        // State
        let userInteracted = false;
        let chimeSound = null;
        let completeSound = null;
        let ukFemaleVoice = null;
        let currentBlockId = null;
        let fiveMinWarningPlayed = {};
        let audioTestArmed = false;
        let lastMinute = -1;
        
        // Logic State
        let isUserScrolling = false;
        let scrollTimeout = null;
        
        const taskCompletion = {
            'block-0900': false, 'block-0955': false, 'block-1115': false,
            'block-1210': false, 'block-1415': false, 'block-1510': false
        };
        const totalTasks = 6;
        const requiredTasks = 4;

        // Data
        const scheduleData = [
            { id: 'block-0830', title: 'Tutor Time / Prep', kickoff: "Time to start. Get prepped. Check Teams for Maths and Core Skills." },
            { id: 'block-0900', title: 'Maths (P1) - Sparx', kickoff: "Maths time. Check Teams and login to Sparx." },
            { id: 'block-0950', title: 'Short Break', kickoff: "Quick 5-minute break." },
            { id: 'block-0955', title: 'Core Skills (P2)', kickoff: "Core Skills. Check Teams or use Typing Club." },
            { id: 'block-1045', title: 'Morning Break', kickoff: "Morning break. Snack time." },
            { id: 'block-1115', title: 'Core Skills (P3)', kickoff: "Core Skills session. Check Teams or Bitesize." },
            { id: 'block-1205', title: 'Short Break', kickoff: "Quick reset before Science." },
            { id: 'block-1210', title: 'How Science Works (P4)', kickoff: "Science time. Check Teams or Oak Academy." },
            { id: 'block-1300', title: 'Lunch & Dog Walk', kickoff: "Lunch time. Eat well and walk the dog." },
            { id: 'block-1400', title: 'Tutor Time PM', kickoff: "Afternoon check-in. Prep for Geography, Biology, and your Coach Call." },
            { id: 'block-1415', title: 'Geography (P5)', kickoff: "Geography. Check Teams or Bitesize. Remember, coach call at 3:30." },
            { id: 'block-1505', title: 'Short Break', kickoff: "Quick break." },
            { id: 'block-1510', title: 'Biology (P6)', kickoff: "Biology. Get this task done before your call." },
            { id: 'block-1528', title: 'Coach Prep Time', kickoff: "Coach Prep Time. 2 minutes. Grab a drink, open Zoom." },
            { id: 'block-1530', title: 'Coach Zoom Session', kickoff: "Coach session. Focus on problem solving." },
            { id: 'block-1545', title: 'Quick Challenge', kickoff: "Wind down with Google Quick Draw." },
            { id: 'block-1600', title: 'Free Time', kickoff: "30 minutes free time." },
            { id: 'block-1630', title: 'Incentive Time!', kickoff: "Gaming hour starts now." },
            { id: 'block-1730', title: 'All Done!', kickoff: "Day complete." }
        ];

        // --- Helpers ---
        function getNaturalTime(date) {
            let h = date.getHours();
            let m = date.getMinutes();
            let displayH = h % 12 || 12;
            let ampm = h >= 12 ? "P M" : "A M";
            let minStr = (m === 0) ? "o'clock" : (m < 10 ? "o " + m : m);
            return `${displayH} ${minStr} ${ampm}`;
        }

        function scrollToBlock(id) {
            if (isUserScrolling || !id) return;
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // --- Audio ---
        function loadVoices() {
            if (!window.speechSynthesis) return;
            const voices = window.speechSynthesis.getVoices();
            ukFemaleVoice = voices.find(v => v.lang === 'en-GB' && (v.name.includes('Female') || v.name.includes('Susan'))) || voices.find(v => v.lang === 'en-GB');
        }

        function speak(text) {
            if (!userInteracted || !window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            if (ukFemaleVoice) u.voice = ukFemaleVoice;
            window.speechSynthesis.speak(u);
        }

        function playChime() {
            if (chimeSound && chimeSound.loaded) chimeSound.start();
        }
        
        function playComplete() {
            if (completeSound && completeSound.loaded) completeSound.start();
        }

        // --- Logic ---
        function update() {
            const today = new Date();
            const Y = today.getFullYear(), M = today.getMonth(), D = today.getDate();
            
            // Helper to set time today
            const t = (h, m) => new Date(Y, M, D, h, m).getTime();

            const schedule = [
                { id: 'block-0830', start: t(8,30), end: t(9,0) },
                { id: 'block-0900', start: t(9,0), end: t(9,50) },
                { id: 'block-0950', start: t(9,50), end: t(9,55) },
                { id: 'block-0955', start: t(9,55), end: t(10,45) },
                { id: 'block-1045', start: t(10,45), end: t(11,15) },
                { id: 'block-1115', start: t(11,15), end: t(12,5) },
                { id: 'block-1205', start: t(12,5), end: t(12,10) },
                { id: 'block-1210', start: t(12,10), end: t(13,0) },
                { id: 'block-1300', start: t(13,0), end: t(14,0) },
                { id: 'block-1400', start: t(14,0), end: t(14,15) },
                { id: 'block-1415', start: t(14,15), end: t(15,5) },
                { id: 'block-1505', start: t(15,5), end: t(15,10) },
                { id: 'block-1510', start: t(15,10), end: t(15,28) },
                { id: 'block-1528', start: t(15,28), end: t(15,30) },
                { id: 'block-1530', start: t(15,30), end: t(15,45) },
                { id: 'block-1545', start: t(15,45), end: t(16,0) },
                { id: 'block-1600', start: t(16,0), end: t(16,30) },
                { id: 'block-1630', start: t(16,30), end: t(17,30) },
                { id: 'block-1730', start: t(17,30), end: t(23,59) }
            ];

            const now = new Date();
            const nowMs = now.getTime();
            
            timeEl.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            // Find Current
            const currentIdx = schedule.findIndex(s => nowMs >= s.start && nowMs < s.end);
            const current = currentIdx !== -1 ? schedule[currentIdx] : null;
            const currentData = current ? scheduleData.find(d => d.id === current.id) : null;

            let newBlockId = current ? current.id : null;

            if (current && currentData) {
                activityEl.textContent = currentData.title;
                
                // Calculations
                const totalDur = current.end - current.start;
                const elapsed = nowMs - current.start;
                const remain = current.end - nowMs;
                const pct = Math.min(100, (elapsed / totalDur) * 100);
                
                // Timer UI
                const minLeft = Math.floor(remain / 60000);
                const secLeft = Math.floor((remain % 60000) / 1000);
                document.getElementById('time-left').textContent = `${minLeft}:${secLeft.toString().padStart(2,'0')}`;
                progressBarEl.style.width = `${pct}%`;
                
                if(currentData.title.includes('Incentive') || currentData.title.includes('All Done')) {
                    timerDetailsEl.classList.add('hidden');
                } else {
                    timerDetailsEl.classList.remove('hidden');
                }

                // Completion Buttons
                const taskCard = document.querySelector(`.academic-task[data-task-id="${current.id}"]`);
                if (taskCard) {
                    const btn = taskCard.querySelector('.complete-btn');
                    if (btn) {
                        // Show only in last 5 mins AND not done
                        if (remain <= 300000 && !taskCompletion[current.id]) {
                            btn.classList.remove('hidden');
                        } else {
                            btn.classList.add('hidden');
                        }
                    }
                }

                // 5 Minute Warning
                if (Math.floor(remain / 1000) === 300 && !fiveMinWarningPlayed[current.id]) {
                    playChime();
                    setTimeout(() => speak("Five minutes left in this session."), 1500);
                    fiveMinWarningPlayed[current.id] = true;
                }

                // Subtle Audio Test
                if (audioTestArmed) {
                    const m = now.getMinutes();
                    if (lastMinute !== -1 && m !== lastMinute) {
                        playChime();
                        const tStr = getNaturalTime(now);
                        setTimeout(() => speak(`The time is ${tStr}. ${minLeft} minutes remaining in ${currentData.title}.`), 1500);
                        audioTestArmed = false;
                    }
                    lastMinute = m;
                }

            } else {
                activityEl.textContent = "Waiting...";
                timerDetailsEl.classList.add('hidden');
            }

            // Visual Updates
            schedule.forEach(s => {
                const el = document.getElementById(s.id);
                if (!el) return;
                
                // Reset styling
                el.classList.remove('current-block', 'completed-block', 'task-card-missed');
                
                // Is Task Complete?
                let isDone = false;
                if (el.classList.contains('academic-task')) {
                    isDone = taskCompletion[el.dataset.taskId];
                    if (isDone) el.classList.add('task-card-complete');
                }

                if (s.id === newBlockId) {
                    if (!isDone) el.classList.add('current-block');
                } else if (nowMs > s.end) {
                    if (!isDone && el.classList.contains('academic-task')) {
                        el.classList.add('task-card-missed');
                    }
                    if (!isDone) el.classList.add('completed-block'); // Grey out if not current
                } else {
                    // Future
                    if (isDone) el.classList.add('task-card-complete');
                }
            });

            // New Session Alert
            if (newBlockId !== currentBlockId) {
                if (currentBlockId !== null && currentData) {
                    playChime();
                    scrollToBlock(newBlockId);
                    setTimeout(() => speak(currentData.kickoff), 1500);
                }
                currentBlockId = newBlockId;
            }
            
            // Smart Scroll
            if (!isUserScrolling && newBlockId) {
                scrollToBlock(newBlockId);
            }
        }

        function runTimer() {
            // Web Worker for background reliability
            const blob = new Blob([`setInterval(() => self.postMessage('tick'), 1000)`], {type: 'text/javascript'});
            const worker = new Worker(URL.createObjectURL(blob));
            worker.onmessage = update;
            update();
        }

        // --- Init Sequence ---
        function start() {
            if (userInteracted) return;
            userInteracted = true;
            startBtnEl.innerText = "Loading...";

            // 1. Init Tone.js
            if (typeof Tone !== 'undefined') {
                Tone.start().then(() => {
                    // Files assumed in root
                    chimeSound = new Tone.Player("bingbong-42645.mp3").toDestination();
                    completeSound = new Tone.Player("string-ending-14456.mp3").toDestination();
                });
            }

            // 2. Init Speech
            if (window.speechSynthesis) {
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
                window.speechSynthesis.speak(new SpeechSynthesisUtterance(" "));
            }

            // 3. UI Transition
            startOverlayEl.style.opacity = '0';
            setTimeout(() => {
                startOverlayEl.style.display = 'none';
                // No un-blur needed for this clean version
            }, 500);

            // 4. Logic
            lastMinute = new Date().getMinutes();
            audioTestArmed = true;
            
            // Scroll listeners
            window.addEventListener('scroll', () => {
                isUserScrolling = true;
                if (scrollTimeout) clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => isUserScrolling = false, 60000);
            }, {passive: true});
            
            // TTS buttons
            document.querySelectorAll('.tts-play-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.blockId;
                    const item = scheduleData.find(x => x.id === id);
                    if (item) speak(item.kickoff);
                });
            });

            // Complete buttons
            document.querySelectorAll('.complete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.dataset.taskId;
                    taskCompletion[id] = true;
                    playComplete();
                    update();
                    checkIncentive();
                });
            });
            
            // Parent Button
            document.getElementById('parent-approval-btn').addEventListener('click', () => {
                if (Object.values(taskCompletion).filter(Boolean).length >= requiredTasks) {
                     document.getElementById('incentive-locked').classList.add('hidden');
                     document.getElementById('incentive-unlocked').classList.remove('hidden');
                     playComplete();
                }
            });

            runTimer();
        }
        
        function checkIncentive() {
            const count = Object.values(taskCompletion).filter(Boolean).length;
            const pct = Math.min(100, (count / requiredTasks) * 100);
            document.getElementById('task-progress-text').innerText = `Tasks Complete: ${count} / 6`;
            document.getElementById('task-progress-bar').style.width = `${pct}%`;
            
            const pBtn = document.getElementById('parent-approval-btn');
            if (count >= requiredTasks) {
                pBtn.disabled = false;
                pBtn.innerText = "Click for Parental Approval";
                pBtn.className = "w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg pulse-approval transition-all";
            }
        }

        startBtnEl.addEventListener('click', start);

    </script>
</body>
</html>
