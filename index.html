<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dexter's Wednesday Plan</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Canvas Confetti for Rewards -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Google Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        /* Custom styles */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s ease;
        }
        
        /* Block Styles */
        .block-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .current-block {
            border-width: 4px;
            border-color: #3b82f6; /* blue-500 */
            transform: scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            z-index: 10;
            position: relative;
        }

        /* Focus Mode: Dim everything else */
        body.focus-mode .block-card:not(.current-block) {
            opacity: 0.1;
            filter: blur(2px);
            pointer-events: none;
            transform: scale(0.95);
        }
        body.focus-mode .current-block {
            transform: scale(1.05);
            box-shadow: 0 0 0 100vmax rgba(0,0,0,0.7); /* Spotlight effect */
            z-index: 50;
        }
        body.focus-mode header, 
        body.focus-mode #status-section {
            z-index: 51; /* Keep header visible */
            position: relative;
        }

        .completed-block {
            background-color: #f3f4f6;
            /* Use rgba for background to look dim without affecting button clickability/opacity recursively */
            color: #4b5563;
            border-left: 4px solid #10b981; /* Green indicator on left */
        }
        
        /* Ensure buttons inside completed blocks are fully visible and clickable */
        .completed-block .complete-btn {
            opacity: 1; 
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .task-card-complete {
             border-color: #10b981;
             background-color: #f0fdf4;
             opacity: 0.8;
        }
        
        .task-card-missed {
            border-color: #f59e0b;
            background-color: #fffbeb;
            border-width: 2px;
        }

        /* Progress bar styles */
        .progress-bar-container {
            width: 100%;
            background-color: rgba(0,0,0,0.2);
            border-radius: 999px;
            overflow: hidden;
            height: 1.25rem;
        }
        .progress-bar {
            height: 100%;
            background-color: #93c5fd; 
            width: 0%;
            transition: width 1s linear; /* Linear for smoother timer feel */
        }

        /* Pulsing animation for approval button */
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 0 12px rgba(16, 185, 129, 0); }
        }
        .pulse-approval {
            animation: pulse-green 2s infinite;
        }
        
        /* Reminder box */
        .reminder-box {
            background-color: #fffbeb;
            border: 1px solid #fde68a;
            border-left-width: 4px;
            border-left-color: #facc15;
            padding: 0.75rem;
            margin-top: 1rem;
            border-radius: 0.375rem;
        }

        /* Start Button Overlay */
        #start-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(17, 24, 39, 0.9); /* Darker backdrop */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 md:p-8 pb-24">

    <!-- Start Button Overlay -->
    <div id="start-overlay">
        <h1 class="text-white text-4xl font-bold mb-2">Ready for Wednesday?</h1>
        <p class="text-gray-300 mb-8 text-lg">Click start to sync audio and timers</p>
        <button id="start-schedule-btn" class="bg-blue-600 text-white font-bold py-4 px-12 rounded-full text-2xl shadow-[0_0_20px_rgba(37,99,235,0.5)] hover:bg-blue-500 hover:scale-105 transition-all transform">
            Start Schedule
        </button>
    </div>

    <div id="main-content" class="max-w-3xl mx-auto hidden">
        
        <!-- Header -->
        <header class="text-center mb-8 transition-all duration-300">
            <h1 class="text-4xl font-bold text-blue-600 uppercase tracking-tight">Wednesday's Plan</h1>
            <p id="current-date-display" class="text-xl text-gray-500 font-medium mt-1"></p>
        </header>

        <!-- Status Section -->
        <div id="status-section" class="bg-blue-600 text-white p-6 rounded-2xl shadow-xl mb-8 text-center sticky top-4 z-20 transition-all duration-300 backdrop-blur-md bg-opacity-95 border border-blue-400/30">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <div class="text-xs font-bold text-blue-200 uppercase tracking-wider">Current Time</div>
                    <div id="current-time" class="text-4xl font-bold tabular-nums tracking-tight">--:--</div>
                </div>
                <div>
                    <div class="text-xs font-bold text-blue-200 uppercase tracking-wider">Current Activity</div>
                    <div id="current-activity" class="text-2xl font-bold leading-tight min-h-[2rem]">Loading...</div>
                </div>
            </div>
            <!-- Time Left and Progress Bar -->
            <div id="timer-details" class="hidden">
                <div class="flex justify-between text-xs font-bold text-blue-200 uppercase mb-1">
                    <span>Time Remaining</span>
                    <span id="time-left">00:00</span>
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- Schedule -->
        <main id="schedule-container" class="space-y-6">

            <!-- Block 1: Tutor Time -->
            <section id="block-0830" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-2xl font-bold text-blue-700">Tutor Time (PSHE)</h2>
                        <button class="tts-play-btn text-blue-400 hover:text-blue-600 transition-colors" data-block-id="block-0830" title="Read instructions">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l8.63-5.89a1.5 1.5 0 000-2.538L6.3 2.841z"></path></svg>
                        </button>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">8:30 - 9:00</span>
                </div>
                <p class="text-gray-600 mb-2">Miss M Bourke (Music Room).</p>
                <p class="text-gray-600">Get ready for the day. Check MS Teams.</p>
            </section>

            <!-- Block 2: Integrated Learning (P1) -->
            <section id="block-0900" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100 academic-task" data-task-id="block-0900">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <div class="check-circle w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-blue-700">Integrated Learning (P1)</h2>
                        <button class="tts-play-btn text-blue-400 hover:text-blue-600" data-block-id="block-0900">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l8.63-5.89a1.5 1.5 0 000-2.538L6.3 2.841z"></path></svg>
                        </button>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">9:00 - 9:50</span>
                </div>
                <p class="text-gray-600 font-semibold mb-2">Mr H Hussain (BG01)</p>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li><b>Check Portal:</b> Log in to MS Teams.</li>
                    <li><b>Task:</b> Complete assigned project work.</li>
                </ul>
                <button class="complete-btn hidden w-full bg-white border-2 border-green-500 text-green-600 font-bold py-3 px-4 rounded-lg hover:bg-green-500 hover:text-white transition-all flex items-center justify-center space-x-2" data-task-id="block-0900">
                    <span>Mark Integrated Learning as Complete</span>
                </button>
            </section>
            
            <!-- Block 3: Short Break -->
            <section id="block-0950" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-xl font-bold text-teal-600">Short Break</h2>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">9:50 - 9:55</span>
                </div>
                <p class="text-gray-600">Quick stretch.</p>
            </section>

            <!-- Block 4: Core Skills (P2) - Swapped from Spanish -->
            <section id="block-0955" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100 academic-task" data-task-id="block-0955">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <div class="check-circle w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-blue-700">Core Skills (P2)</h2>
                        <button class="tts-play-btn text-blue-400 hover:text-blue-600" data-block-id="block-0955">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l8.63-5.89a1.5 1.5 0 000-2.538L6.3 2.841z"></path></svg>
                        </button>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">9:55 - 10:45</span>
                </div>
                <p class="text-blue-600 text-sm mb-2 font-bold">REPLACING SPANISH</p>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li><b>Check MS Teams:</b> Look for Core Skills tasks.</li>
                    <li><b>Fallback:</b> <a href="https://www.typingclub.com/" target="_blank" class="text-blue-600 underline hover:text-blue-800">TypingClub</a> (15-20 mins).</li>
                </ul>
                 <button class="complete-btn hidden w-full bg-white border-2 border-green-500 text-green-600 font-bold py-3 px-4 rounded-lg hover:bg-green-500 hover:text-white transition-all flex items-center justify-center space-x-2" data-task-id="block-0955">
                    <span>Mark Core Skills as Complete</span>
                </button>
            </section>
            
            <!-- Block 5: Morning Break -->
            <section id="block-1045" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-2xl font-bold text-teal-600">Morning Break</h2>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">10:45 - 11:15</span>
                </div>
                <p class="text-gray-600">Proper break. Get a snack.</p>
            </section>
            
            <!-- Block 6: Maths (P3) -->
            <section id="block-1115" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100 academic-task" data-task-id="block-1115">
                <div class="flex justify-between items-center mb-2">
                     <div class="flex items-center space-x-3">
                        <div class="check-circle w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-blue-700">Maths (P3)</h2>
                        <button class="tts-play-btn text-blue-400 hover:text-blue-600" data-block-id="block-1115">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l8.63-5.89a1.5 1.5 0 000-2.538L6.3 2.841z"></path></svg>
                        </button>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">11:15 - 12:05</span>
                </div>
                <p class="text-gray-600 font-semibold mb-2">Miss E Jenkinson (H102)</p>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li><b>Check MS Teams:</b> Check for Maths work.</li>
                    <li><b>Platform:</b> Likely Sparx Maths or Teams assignment.</li>
                </ul>
                 <button class="complete-btn hidden w-full bg-white border-2 border-green-500 text-green-600 font-bold py-3 px-4 rounded-lg hover:bg-green-500 hover:text-white transition-all flex items-center justify-center space-x-2" data-task-id="block-1115">
                    <span>Mark Maths as Complete</span>
                </button>
            </section>
            
            <!-- Block 7: Short Break -->
            <section id="block-1205" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-xl font-bold text-teal-600">Short Break</h2>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">12:05 - 12:10</span>
                </div>
                <p class="text-gray-600">Quick reset.</p>
            </section>
            
            <!-- Block 8: How Science Works (P4) -->
            <section id="block-1210" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100 academic-task" data-task-id="block-1210">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <div class="check-circle w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-blue-700">How Science Works (P4)</h2>
                        <button class="tts-play-btn text-blue-400 hover:text-blue-600" data-block-id="block-1210">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l8.63-5.89a1.5 1.5 0 000-2.538L6.3 2.841z"></path></svg>
                        </button>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">12:10 - 13:00</span>
                </div>
                <p class="text-gray-600 font-semibold mb-2">Miss E McGrath (Lab 2)</p>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li><b>Check MS Teams:</b> Science lesson.</li>
                    <li><b>Goal:</b> Watch video, quiz, worksheet.</li>
                </ul>
                 <button class="complete-btn hidden w-full bg-white border-2 border-green-500 text-green-600 font-bold py-3 px-4 rounded-lg hover:bg-green-500 hover:text-white transition-all flex items-center justify-center space-x-2" data-task-id="block-1210">
                    <span>Mark Science as Complete</span>
                </button>
            </section>

            <!-- Block 9: Lunch & Dog Walk -->
            <section id="block-1300" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-2xl font-bold text-teal-600">Lunch & Dog Walk</h2>
                        <!-- Added a dog icon here just for fun -->
                        <span class="text-2xl">üêï</span>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">13:00 - 14:00</span>
                </div>
                <p class="text-gray-600">Eat well, hydrate, and take the dog for a walk.</p>
            </section>
            
            <!-- Block 10: Tutor Time PM -->
            <section id="block-1400" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-2xl font-bold text-blue-700">Tutor Time PM</h2>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">14:00 - 14:15</span>
                </div>
                <p class="text-gray-600 font-semibold mb-2">Miss E McGrath (Lab 2)</p>
                <p class="text-gray-600">Afternoon registration.</p>
            </section>
            
            <!-- Block 11: Geography -->
            <section id="block-1415" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100 academic-task" data-task-id="block-1415">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <div class="check-circle w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-blue-700">Geography (P5)</h2>
                        <button class="tts-play-btn text-blue-400 hover:text-blue-600" data-block-id="block-1415">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l8.63-5.89a1.5 1.5 0 000-2.538L6.3 2.841z"></path></svg>
                        </button>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">14:15 - 15:05</span>
                </div>
                <p class="text-gray-600 font-semibold mb-2">Mr J Harte (B102)</p>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li><b>Check Portal:</b> Geography lesson.</li>
                    <li><b>Task:</b> Complete assigned work.</li>
                </ul>
                 <button class="complete-btn hidden w-full bg-white border-2 border-green-500 text-green-600 font-bold py-3 px-4 rounded-lg hover:bg-green-500 hover:text-white transition-all flex items-center justify-center space-x-2" data-task-id="block-1415">
                    <span>Mark Geography as Complete</span>
                </button>
            </section>
            
            <!-- Block 12: Short Break -->
            <section id="block-1505" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-xl font-bold text-teal-600">Short Break</h2>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">15:05 - 15:10</span>
                </div>
                <p class="text-gray-600">Final quick break.</p>
            </section>
            
            <!-- Block 13: Core Skills (P6) - Swapped from French -->
            <section id="block-1510" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100 academic-task" data-task-id="block-1510">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <div class="check-circle w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-blue-700">Core Skills (P6)</h2>
                        <button class="tts-play-btn text-blue-400 hover:text-blue-600" data-block-id="block-1510">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l8.63-5.89a1.5 1.5 0 000-2.538L6.3 2.841z"></path></svg>
                        </button>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">15:10 - 16:00</span>
                </div>
                <p class="text-blue-600 text-sm mb-2 font-bold">REPLACING FRENCH</p>
                <ul class="list-decimal list-inside space-y-2 mb-4 text-gray-600">
                    <li><b>Task:</b> Catch up on any Core Skills.</li>
                    <li><b>Alternative:</b> BBC Bitesize or TypingClub.</li>
                    <li><b>Goal:</b> Finish strong.</li>
                </ul>
                 <button class="complete-btn hidden w-full bg-white border-2 border-green-500 text-green-600 font-bold py-3 px-4 rounded-lg hover:bg-green-500 hover:text-white transition-all flex items-center justify-center space-x-2" data-task-id="block-1510">
                    <span>Mark Core Skills as Complete</span>
                </button>
            </section>

            <!-- Block 17: Free Time -->
            <section id="block-1600" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-2xl font-bold text-gray-700">Free Time / Wind Down</h2>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">16:00 - 16:30</span>
                </div>
                <p class="text-gray-600">Relax before gaming hour.</p>
            </section>

            <!-- Block 18: Incentive Time! -->
            <section id="block-1630" class="block-card bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl shadow-md border border-blue-200">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-3xl font-bold text-indigo-700">Incentive Time!</h2>
                        <span class="text-3xl">üéÆ</span>
                    </div>
                    <span class="text-lg font-semibold text-indigo-600 bg-indigo-100 px-3 py-1 rounded-lg">16:30 - 17:30</span>
                </div>
                
                <!-- Locked State -->
                <div id="incentive-locked" class="bg-white p-6 rounded-xl border border-gray-200">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-gray-600 font-medium">Progress to Reward</span>
                        <span id="task-progress-text" class="font-bold text-indigo-600">0 / 6</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-6 mb-6 overflow-hidden">
                        <div id="task-progress-bar" class="bg-indigo-500 h-6 rounded-full transition-all duration-700 ease-out" style="width: 0%"></div>
                    </div>
                    
                    <button id="parent-approval-btn" class="w-full bg-gray-300 text-gray-500 font-bold py-4 px-4 rounded-xl transition-all cursor-not-allowed flex items-center justify-center" disabled>
                        <span class="mr-2">üîí</span> Complete 4 tasks to unlock
                    </button>
                </div>

                <!-- Unlocked State -->
                <div id="incentive-unlocked" class="hidden bg-green-50 p-6 rounded-xl border border-green-200 text-center transform transition-all duration-500 scale-95">
                    <h3 class="text-3xl font-bold text-green-600 mb-2">REWARD UNLOCKED!</h3>
                    <p class="text-gray-600 text-lg mb-4">Great work today, Dexter!</p>
                    <div class="inline-block p-4 bg-white border-2 border-green-400 rounded-xl shadow-sm">
                        <strong class="text-green-800 text-xl">Reward:</strong> <span class="text-gray-800 text-lg">1 Hour Gaming Time</span>
                    </div>
                </div>
            </section>
            
            <!-- Block 19: All Done -->
            <section id="block-1730" class="block-card bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-2xl font-bold text-gray-700">All Done!</h2>
                    </div>
                    <span class="text-lg font-semibold text-gray-500 bg-gray-50 px-3 py-1 rounded-lg">17:30+</span>
                </div>
                <p class="text-gray-600">Day complete. Well done.</p>
            </section>

        </main>
        
        <!-- Footer / Reset -->
        <footer class="mt-12 pb-8 flex flex-col items-center space-y-4">
            <!-- Audio Test Section -->
            <div class="flex space-x-4 bg-white px-4 py-2 rounded-full shadow-sm border border-gray-200">
                <button onclick="playTickSound()" class="text-sm text-blue-500 hover:text-blue-700 flex items-center space-x-1" title="Test Click Sound">
                    <span>üîä Tick</span>
                </button>
                <span class="text-gray-300">|</span>
                <button onclick="playChimeSound()" class="text-sm text-blue-500 hover:text-blue-700 flex items-center space-x-1" title="Test Chime Sound">
                    <span>üîî Chime</span>
                </button>
                <span class="text-gray-300">|</span>
                <button onclick="playCompleteSound()" class="text-sm text-green-600 hover:text-green-800 flex items-center space-x-1" title="Test Reward Sound">
                    <span>üéâ Reward</span>
                </button>
            </div>
            
            <button id="reset-day-btn" class="text-xs text-gray-400 hover:text-red-500 transition-colors">
                Reset Daily Progress (Debug)
            </button>
        </footer>
    </div>

    <!-- Focus Mode Button (Replaced AI Helper) -->
    <button id="focus-mode-btn" class="fixed bottom-6 right-6 bg-indigo-600 text-white p-4 rounded-full shadow-2xl hover:bg-indigo-700 hover:scale-110 transition-all z-50 group" title="Toggle Focus Mode">
        <span class="absolute right-14 top-2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">Focus Mode</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
    </button>

    <!-- Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js" onload="initSound()" async defer></script>
    
    <script>
        // --- CONFIG ---
        // Use local storage key based on date so it resets automatically tomorrow!
        const TODAY_KEY = new Date().toLocaleDateString('en-GB'); 
        const STORAGE_KEY = `dexter_plan_${TODAY_KEY}`;
        
        // --- DOM Elements ---
        const timeEl = document.getElementById('current-time');
        const activityEl = document.getElementById('current-activity');
        const timeLeftEl = document.getElementById('time-left');
        const timerDetailsEl = document.getElementById('timer-details');
        const progressBarEl = document.getElementById('progress-bar');
        const startOverlayEl = document.getElementById('start-overlay');
        const startBtnEl = document.getElementById('start-schedule-btn');
        const mainContentEl = document.getElementById('main-content');
        const focusModeBtn = document.getElementById('focus-mode-btn');
        const dateDisplayEl = document.getElementById('current-date-display');

        // --- State Variables ---
        let toneSoundEnabled = false;
        let userInteracted = false;
        let currentBlockId = null;
        let chimeSound, completeSound;
        let ukFemaleVoice = null;
        let fiveMinWarningPlayed = {};
        let worker;
        let isUserScrolling = false;
        let scrollTimeout = null;
        let isFocusMode = false;

        // --- Load / Init State ---
        // Load from local storage or default
        let savedState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let taskCompletion = savedState.taskCompletion || {
            'block-0900': false,
            'block-0955': false,
            'block-1115': false,
            'block-1210': false,
            'block-1415': false,
            'block-1510': false
        };
        
        const totalTasks = Object.keys(taskCompletion).length;
        const requiredTasks = 4;
        const incentiveProgressText = document.getElementById('task-progress-text');
        const incentiveProgressBar = document.getElementById('task-progress-bar');
        const parentApprovalBtn = document.getElementById('parent-approval-btn');

        // --- Schedule Data (WEDNESDAY) ---
        // P2 (9:55) and P6 (15:10) are now Core Skills
        const scheduleData = [
            { id: 'block-0830', title: 'Tutor Time (PSHE)', kickoff: "Good morning Dexter. It's Wednesday, Tutor Time with Miss Bourke." },
            { id: 'block-0900', title: 'Integrated Learning (P1)', kickoff: "First lesson: Integrated Learning with Mr Hussain." },
            { id: 'block-0950', title: 'Short Break', kickoff: "Take a breather. 5 minutes." },
            { id: 'block-0955', title: 'Core Skills (P2)', kickoff: "Period 2. Core Skills instead of Spanish. Check Teams for your tasks." },
            { id: 'block-1045', title: 'Morning Break', kickoff: "Morning break. Get a snack." },
            { id: 'block-1115', title: 'Maths (P3)', kickoff: "Maths time with Miss Jenkinson." },
            { id: 'block-1205', title: 'Short Break', kickoff: "Quick reset." },
            { id: 'block-1210', title: 'How Science Works (P4)', kickoff: "Science time with Miss McGrath." },
            { id: 'block-1300', title: 'Lunch & Dog Walk', kickoff: "Lunch time. Take the dog out!" },
            { id: 'block-1400', title: 'Tutor Time PM', kickoff: "Afternoon check in with Miss McGrath." },
            { id: 'block-1415', title: 'Geography (P5)', kickoff: "Geography with Mr Harte." },
            { id: 'block-1505', title: 'Short Break', kickoff: "Last break before the final push." },
            { id: 'block-1510', title: 'Core Skills (P6)', kickoff: "Final lesson. Core Skills instead of French. Let's finish the day strong." },
            { id: 'block-1600', title: 'Free Time', kickoff: "School's out. Relax for 30 minutes." },
            { id: 'block-1630', title: 'Incentive Time!', kickoff: "Gaming time unlocked if you finished your tasks." },
            { id: 'block-1730', title: 'All Done!', kickoff: "Day complete." }
        ];

        // --- Logic ---

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({ taskCompletion }));
        }

        function updateDateDisplay() {
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            dateDisplayEl.textContent = new Date().toLocaleDateString('en-GB', options);
        }

        function updateSchedule() {
            const now = new Date();
            const nowTime = now.getTime();
            
            // Dynamic day schedule creation (maps generic hours to today)
            const schedule = scheduleData.map(block => {
                return block; 
            });

            // Reconstruct time boundaries for TODAY (WEDNESDAY TIMINGS)
            const createTime = (h, m) => new Date(now).setHours(h, m, 0, 0);
            
            // Mapping logic strictly from the Wednesday visual schedule
            // P6 ends at 16:00 on Wednesday
            const timeMap = [
                { s: [8,30], e: [9,0] }, // 0830 Tutor
                { s: [9,0], e: [9,50] }, // 0900 P1
                { s: [9,50], e: [9,55] }, // 0950 Break
                { s: [9,55], e: [10,45] }, // 0955 P2
                { s: [10,45], e: [11,15] }, // 1045 Break
                { s: [11,15], e: [12,5] }, // 1115 P3
                { s: [12,5], e: [12,10] }, // 1205 Break
                { s: [12,10], e: [13,0] }, // 1210 P4
                { s: [13,0], e: [14,0] }, // 1300 Lunch
                { s: [14,0], e: [14,15] }, // 1400 Tutor
                { s: [14,15], e: [15,5] }, // 1415 P5
                { s: [15,5], e: [15,10] }, // 1505 Break
                { s: [15,10], e: [16,0] }, // 1510 P6 (Full hour)
                { s: [16,0], e: [16,30] }, // 1600 Free Time
                { s: [16,30], e: [17,30] }, // 1630 Incentive
                { s: [17,30], e: [23,59] }  // 1730 Done
            ];

            // Hydrate schedule with real times
            scheduleData.forEach((block, i) => {
                block.start = createTime(...timeMap[i].s);
                block.end = createTime(...timeMap[i].e);
            });

            timeEl.textContent = now.toTimeString().slice(0, 5); // HH:MM

            const currentBlock = scheduleData.find(block => nowTime >= block.start && nowTime < block.end);
            let newBlockId = null;

            if (currentBlock) {
                newBlockId = currentBlock.id;
                activityEl.textContent = currentBlock.title;
                
                // Timer Calc
                const timeLeftMs = currentBlock.end - nowTime;
                const minutesLeft = Math.floor(timeLeftMs / 60000);
                const secondsLeft = Math.floor((timeLeftMs % 60000) / 1000);
                timeLeftEl.textContent = `${minutesLeft}m ${secondsLeft}s`;

                const totalDur = currentBlock.end - currentBlock.start;
                const elapsed = nowTime - currentBlock.start;
                const pct = (elapsed / totalDur) * 100;
                progressBarEl.style.width = `${pct}%`;

                timerDetailsEl.classList.remove('hidden');

                // Hide timer for loose blocks
                if(currentBlock.title.includes('Incentive') || currentBlock.title.includes('All Done')) {
                    timerDetailsEl.classList.add('hidden');
                }

                // 5 Min Warning
                if (minutesLeft === 5 && secondsLeft === 0 && !fiveMinWarningPlayed[newBlockId]) {
                    playChimeSound();
                    setTimeout(() => playSystemTTS("Five minutes remaining."), 1500);
                    fiveMinWarningPlayed[newBlockId] = true;
                }

            } else {
                // Outside schedule
                if (nowTime < scheduleData[0].start) {
                    activityEl.textContent = "Not started yet";
                    timerDetailsEl.classList.add('hidden');
                } else {
                    activityEl.textContent = "Day Complete";
                }
            }

            // Task button visibility
            document.querySelectorAll('.academic-task').forEach(card => {
                const taskId = card.dataset.taskId;
                const btn = card.querySelector('.complete-btn');
                const blockData = scheduleData.find(b => b.id === card.id);
                
                // Logic: If task NOT done AND time is past start time -> SHOW BUTTON
                const hasStarted = blockData && nowTime >= blockData.start;
                
                if (hasStarted && !taskCompletion[taskId] && btn) {
                    btn.classList.remove('hidden');
                } else if (btn) {
                    btn.classList.add('hidden');
                }
            });

            // Update visual classes
            scheduleData.forEach(block => {
                const el = document.getElementById(block.id);
                if(!el) return;

                const isComplete = taskCompletion[block.id] || false;

                // Reset classes
                el.classList.remove('current-block', 'completed-block', 'task-card-missed');

                if (block.id === newBlockId) {
                    el.classList.add('current-block');
                } else if (nowTime > block.end) {
                    el.classList.add('completed-block');
                    // Mark as missed if it was academic and not checked
                    if (el.classList.contains('academic-task') && !isComplete) {
                        el.classList.add('task-card-missed');
                    }
                }

                // Always apply green state if done
                if (isComplete && el.classList.contains('academic-task')) {
                    el.classList.add('task-card-complete');
                    el.classList.remove('task-card-missed', 'completed-block'); // Remove grey/amber
                    el.querySelector('.check-icon').classList.remove('hidden');
                    el.querySelector('.check-circle').classList.add('bg-green-500', 'border-transparent');
                }
            });

            // Kickoff / Scroll
            if (newBlockId !== currentBlockId) {
                if (currentBlockId !== null && currentBlock) {
                    playChimeSound();
                    scrollToCurrentBlock(newBlockId);
                    if (currentBlock.kickoff) setTimeout(() => playSystemTTS(currentBlock.kickoff), 2000);
                }
                currentBlockId = newBlockId;
            }
            
            // Auto-scroll idle check
            if (!isUserScrolling && currentBlockId) {
                // Only force scroll if we are NOT in focus mode (focus mode handles its own view)
                // Actually focus mode might need help centering too.
                // Let's leave auto-scroll gentle.
            }
        }

        // --- Audio Logic (Robust) ---
        // Using standard HTML5 Audio for reliability with simple files
        const audioFiles = {
            chime: new Audio("https://infiniteplayers.github.io/Lesson/bingbong-42645.mp3"),
            tick: new Audio("https://infiniteplayers.github.io/Lesson/back-tick-107822.mp3"),
            complete: new Audio("https://infiniteplayers.github.io/Lesson/string-ending-14456.mp3")
        };

        function playChimeSound() {
            if(!userInteracted) return;
            // Reset to start if already playing
            audioFiles.chime.currentTime = 0;
            audioFiles.chime.play().catch(e => console.error("Audio play failed:", e));
        }
        
        function playTickSound() {
            if(!userInteracted) return;
            audioFiles.tick.currentTime = 0;
            audioFiles.tick.play().catch(e => console.error("Audio play failed:", e));
        }

        function playCompleteSound() {
            if(!userInteracted) return;
            audioFiles.complete.currentTime = 0;
            audioFiles.complete.play().catch(e => console.error("Audio play failed:", e));
        }

        function initSound() {
            if (typeof Tone !== 'undefined' && userInteracted) {
                Tone.start().then(() => {
                    console.log("Tone.js Context Started");
                    toneSoundEnabled = true;
                }).catch(e => console.log("Tone start failed", e));
            }
        }

        function playSystemTTS(text) {
            if (!userInteracted || !('speechSynthesis' in window)) return;
            speechSynthesis.cancel();
            const utt = new SpeechSynthesisUtterance(text);
            // Try to find a nice voice
            const voices = speechSynthesis.getVoices();
            const preferred = voices.find(v => v.name.includes('Google UK English Female') || v.name.includes('Samantha'));
            if (preferred) utt.voice = preferred;
            speechSynthesis.speak(utt);
        }

        // --- Features ---
        
        // 1. Task Completion
        function updateTaskUI() {
            let count = 0;
            for (let k in taskCompletion) {
                if (taskCompletion[k]) count++;
            }
            
            const pct = Math.min(100, (count / requiredTasks) * 100);
            incentiveProgressText.textContent = `${count} / ${totalTasks}`;
            incentiveProgressBar.style.width = `${pct}%`;

            if (count >= requiredTasks) {
                parentApprovalBtn.disabled = false;
                parentApprovalBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                parentApprovalBtn.classList.add('bg-green-500', 'text-white', 'hover:bg-green-600', 'pulse-approval', 'cursor-pointer');
                parentApprovalBtn.innerHTML = `<span>üîì</span> Click to Unlock Reward`;
            }
            
            // Save
            saveState();
        }

        function setupCompletion() {
            document.querySelectorAll('.complete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.taskId;
                    taskCompletion[id] = true;
                    playTickSound(); // Play tick sound on task completion
                    updateSchedule(); // Refresh UI classes
                    updateTaskUI();
                });
            });

            parentApprovalBtn.addEventListener('click', () => {
                if (parentApprovalBtn.disabled) return;
                
                document.getElementById('incentive-locked').classList.add('hidden');
                document.getElementById('incentive-unlocked').classList.remove('hidden');
                document.getElementById('incentive-unlocked').classList.add('scale-100');
                
                // CONFETTI!
                playCompleteSound(); // Play reward sound on unlock
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#10b981', '#3b82f6', '#f59e0b']
                });
            });
            
            // Init UI state
            updateTaskUI();
        }

        // 2. Focus Mode
        focusModeBtn.addEventListener('click', () => {
            isFocusMode = !isFocusMode;
            document.body.classList.toggle('focus-mode');
            focusModeBtn.classList.toggle('bg-indigo-600');
            focusModeBtn.classList.toggle('bg-red-500');
            
            if(isFocusMode && currentBlockId) {
                 scrollToCurrentBlock(currentBlockId);
            }
        });

        // 3. Scroll Helper
        function scrollToCurrentBlock(id) {
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // 4. Reset
        document.getElementById('reset-day-btn').addEventListener('click', () => {
            if(confirm("Reset all progress for today?")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        });

        // --- Main Loop ---
        function startSchedule() {
            userInteracted = true;
            startOverlayEl.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => startOverlayEl.style.display = 'none', 500);
            
            mainContentEl.classList.remove('hidden');
            
            initSound();
            
            // Worker for timer
            const blob = new Blob([`setInterval(() => postMessage('tick'), 1000)`], {type: 'application/javascript'});
            worker = new Worker(URL.createObjectURL(blob));
            worker.onmessage = updateSchedule;
            
            // Initial run
            updateDateDisplay();
            updateSchedule();
            setupCompletion();
            
            // Setup Play buttons
            document.querySelectorAll('.tts-play-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Don't trigger card clicks if any
                    const block = scheduleData.find(b => b.id === e.currentTarget.dataset.blockId);
                    if(block) playSystemTTS(block.kickoff);
                });
            });
        }

        startBtnEl.addEventListener('click', startSchedule);

        // Scroll listener
        window.addEventListener('scroll', () => {
            isUserScrolling = true;
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => isUserScrolling = false, 15000); // 15s pause on auto-scroll
        }, { passive: true });

    </script>
</body>
</html>
